<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Raspberry AR</title>
    <meta name="description" content="Raspberry AR demo using A-Frame and MindAR.">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mindar-sdk"></script>
    <script>
      AFRAME.registerComponent('markerhandler', {
        init: function () {
          this.markerCounter = 0;
          this.markerMaxCount = 10;

          this.mindARLibrary = new mindAR.MindAR(document.querySelector('canvas'));

          this.mindARLibrary.start('targets.mind');
          this.mindARLibrary.addEventListener('markerFound', this.onMarkerFound.bind(this));
        },

        onMarkerFound: function (marker) {
          var sceneEl = document.querySelector('a-scene');

          if (this.markerCounter < this.markerMaxCount) {
            // Create a random size
            var scale = ((Math.random() * 2) + 1) / 10;

            // Create a random rotation
            var rotation = {
              x: (Math.random() * 360),
              y: (Math.random() * 360),
              z: (Math.random() * 360)
            };

            // Create a random position offset from the marker
            var positionOffset = {
              x: ((Math.random() * 4) - 2),
              y: ((Math.random() * 4) - 2),
              z: ((Math.random() * 4) - 2)
            };

            // Create the model entity
            var modelEl = document.createElement('a-entity');
            modelEl.setAttribute('gltf-model', 'ruspberry.gltf');
            modelEl.setAttribute('scale', { x: scale, y: scale, z: scale });
            modelEl.setAttribute('rotation', rotation);
            modelEl.setAttribute('position', {
              x: marker.position.x + positionOffset.x,
              y: marker.position.y + positionOffset.y,
              z: marker.position.z + positionOffset.z
            });

            // Add the model entity to the scene
            sceneEl.appendChild(modelEl);

            this.markerCounter++;
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene markerhandler embedded>
      <a-camera></a-camera>
    </a-scene>
  </body>
</html>
